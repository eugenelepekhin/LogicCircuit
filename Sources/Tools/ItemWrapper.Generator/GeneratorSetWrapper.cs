// ------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version: 10.0.0.0
//  
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
// ------------------------------------------------------------------------------
namespace ItemWrapper.Generator
{
    using System.Collections.Generic;
    using System.Linq;
    using System;
    
    
    #line 1 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
    [System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.TextTemplating", "10.0.0.0")]
    public partial class GeneratorSetWrapper : Transformation
    {
        #region ToString Helpers
        /// <summary>
        /// Utility class to produce culture-oriented representation of an object as a string.
        /// </summary>
        public class ToStringInstanceHelper
        {
            private System.IFormatProvider formatProviderField  = global::System.Globalization.CultureInfo.InvariantCulture;
            /// <summary>
            /// Gets or sets format provider to be used by ToStringWithCulture method.
            /// </summary>
            public System.IFormatProvider FormatProvider
            {
                get
                {
                    return this.formatProviderField ;
                }
                set
                {
                    if ((value != null))
                    {
                        this.formatProviderField  = value;
                    }
                }
            }
            /// <summary>
            /// This is called from the compile/run appdomain to convert objects within an expression block to a string
            /// </summary>
            public string ToStringWithCulture(object objectToConvert)
            {
                if ((objectToConvert == null))
                {
                    throw new global::System.ArgumentNullException("objectToConvert");
                }
                System.Type t = objectToConvert.GetType();
                System.Reflection.MethodInfo method = t.GetMethod("ToString", new System.Type[] {
                            typeof(System.IFormatProvider)});
                if ((method == null))
                {
                    return objectToConvert.ToString();
                }
                else
                {
                    return ((string)(method.Invoke(objectToConvert, new object[] {
                                this.formatProviderField })));
                }
            }
        }
        private ToStringInstanceHelper toStringHelperField = new ToStringInstanceHelper();
        public ToStringInstanceHelper ToStringHelper
        {
            get
            {
                return this.toStringHelperField;
            }
        }
        #endregion
        public override string TransformText()
        {
            this.GenerationEnvironment = null;
            
            #line 4 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"

	bool isSubclass = this.Table.IsSubclass();
	string createParam = "RowId rowId";
	string newParam = "this." + this.Store.Name + ", rowId";
	if(isSubclass) {
		foreach(Table parent in this.Table.Ancestors(false)) {
			createParam += ", RowId " + parent.Name + "RowId";
			newParam += ", " + parent.Name + "RowId";
		}
	}

            
            #line default
            #line hidden
            this.Write("\t// Wrapper for table ");
            
            #line 15 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(".\r\n\tpartial class ");
            
            #line 16 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Set : INotifyCollectionChanged, IEnumerable<");
            
            #line 16 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("> {\r\n\r\n\t\tpublic event NotifyCollectionChangedEventHandler CollectionChanged;\r\n\r\n\t" +
                    "\tinternal TableSnapshot<");
            
            #line 20 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Data> Table { get; private set; }\r\n\r\n");
            
            #line 22 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
if(this.RealmType != RealmType.Universe) {
            
            #line default
            #line hidden
            this.Write("\t\t// Maps rowId to row wrapper\r\n\t\tprivate Dictionary<RowId, ");
            
            #line 24 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("> itemByRowId = new Dictionary<RowId, ");
            
            #line 24 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(">();\r\n\r\n");
            
            #line 26 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
}
            
            #line default
            #line hidden
            this.Write("\t\t// Gets StoreSnapshot this set belongs to.\r\n\t\tpublic ");
            
            #line 28 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Store.Name));
            
            #line default
            #line hidden
            this.Write(" ");
            
            #line 28 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Store.Name));
            
            #line default
            #line hidden
            this.Write(" { get { return (");
            
            #line 28 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Store.Name));
            
            #line default
            #line hidden
            this.Write(")this.Table.StoreSnapshot; } }\r\n\r\n\t\t// Constructor\r\n\t\tpublic ");
            
            #line 31 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Set(");
            
            #line 31 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Store.Name));
            
            #line default
            #line hidden
            this.Write(" store) {\r\n\t\t\tITableSnapshot table = store.Table(\"");
            
            #line 32 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("\");\r\n\t\t\tif(table != null) {\r\n\t\t\t\tDebug.Assert(store.IsFrozen, \"The store should b" +
                    "e frozen\");\r\n\t\t\t\tthis.Table = (TableSnapshot<");
            
            #line 35 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Data>)table;\r\n\t\t\t} else {\r\n\t\t\t\tDebug.Assert(!store.IsFrozen, \"In order to create " +
                    "table, the store should not be frozen\");\r\n\t\t\t\tthis.Table = ");
            
            #line 38 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Data.CreateTable(store);\r\n\t\t\t}\r\n\t\t\tthis.Initialize");
            
            #line 40 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Set();\r\n\t\t}\r\n\r\n\t\tpartial void Initialize");
            
            #line 43 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Set();\r\n\r\n\t\t//internal void Register() {\r\n\t\t//\tforeach(RowId rowId in this.Table." +
                    "Rows) {\r\n\t\t//\t\tthis.FindOrCreate(rowId);\r\n\t\t//\t}\r\n\t\t//}\r\n\r\n");
            
            #line 51 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
if(this.RealmType == RealmType.Multiverse) {
            
            #line default
            #line hidden
            this.Write("\t\t// Registers wrapper\r\n\t\tinternal void Register");
            
            #line 53 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("(");
            
            #line 53 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(" item) {\r\n\t\t\tthis.itemByRowId.Add(item.");
            
            #line 54 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("RowId, item);\r\n");
            
            #line 55 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
	if(isSubclass) {
            
            #line default
            #line hidden
            this.Write("\t\t\tthis.");
            
            #line 56 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Store.Name));
            
            #line default
            #line hidden
            this.Write(".");
            
            #line 56 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.BaseName()));
            
            #line default
            #line hidden
            this.Write("Set.Register");
            
            #line 56 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.BaseName()));
            
            #line default
            #line hidden
            this.Write("(item);\r\n");
            
            #line 57 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
	}
            
            #line default
            #line hidden
            this.Write("\t\t}\r\n");
            
            #line 59 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
}
            
            #line default
            #line hidden
            this.Write("\r\n\t\t// gets items wrapper by RowId\r\n\t\tpublic ");
            
            #line 62 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(" Find(RowId rowId) {\r\n");
            
            #line 63 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
if(this.RealmType == RealmType.Universe) {
            
            #line default
            #line hidden
            this.Write("\t\t\tif(!rowId.IsEmpty) {\r\n\t\t\t\treturn this.Table.GetField(rowId, ");
            
            #line 65 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Data.");
            
            #line 65 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Field.Field);\r\n\t\t\t}\r\n");
            
            #line 67 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
} else if(this.RealmType == RealmType.Multiverse) {
            
            #line default
            #line hidden
            this.Write("\t\t\t");
            
            #line 68 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(" item;\r\n\t\t\tif(this.itemByRowId.TryGetValue(rowId, out item)) {\r\n\t\t\t\treturn item;\r" +
                    "\n\t\t\t}\r\n");
            
            #line 72 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
}
            
            #line default
            #line hidden
            this.Write("\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tprivate void Delete(RowId rowId) {\r\n");
            
            #line 77 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
if(this.RealmType == RealmType.Multiverse) {
            
            #line default
            #line hidden
            this.Write("\t\t\tif(this.itemByRowId.ContainsKey(rowId)) {\r\n\t\t\t\tthis.itemByRowId.Remove(rowId);" +
                    "\r\n\t\t\t}\r\n");
            
            #line 81 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
}
            
            #line default
            #line hidden
            this.Write("\t\t}\r\n\r\n\t\t// gets items wrapper by RowId\r\n\t\tprivate IEnumerable<");
            
            #line 85 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("> Select(IEnumerable<RowId> rows) {\r\n\t\t\tforeach(RowId rowId in rows) {\r\n\t\t\t\t");
            
            #line 87 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(" item = this.Find(rowId);\r\n\t\t\t\tDebug.Assert(item != null, \"What is the reason for" +
                    " the item not to be found?\");\r\n\t\t\t\tyield return item;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Create " +
                    "wrapper for the row and register it in the dictionary\r\n\t\tprivate ");
            
            #line 94 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(" Create(");
            
            #line 94 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(createParam));
            
            #line default
            #line hidden
            this.Write(") {\r\n");
            
            #line 95 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
if(this.Table.ItemModifier == ItemModifier.None) {
            
            #line default
            #line hidden
            this.Write("\t\t\t");
            
            #line 96 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(" item = new ");
            
            #line 96 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("(");
            
            #line 96 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(newParam));
            
            #line default
            #line hidden
            this.Write(");\r\n");
            
            #line 97 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
	if(this.RealmType == RealmType.Multiverse) {
            
            #line default
            #line hidden
            this.Write("\t\t\tthis.Register");
            
            #line 98 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("(item);\r\n");
            
            #line 99 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
	}
            
            #line default
            #line hidden
            this.Write("\t\t\treturn item;\r\n");
            
            #line 101 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
} else {
            
            #line default
            #line hidden
            this.Write("\t\t\tthrow new InvalidOperationException();\r\n");
            
            #line 103 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
}
            
            #line default
            #line hidden
            this.Write("\t\t}\r\n\r\n\t\t[System.Diagnostics.CodeAnalysis.SuppressMessage(\"Microsoft.Maintainabil" +
                    "ity\", \"CA1506:AvoidExcessiveClassCoupling\")]\r\n\t\tinternal ");
            
            #line 107 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(" FindOrCreate(RowId rowId) {\r\n\t\t\tDebug.Assert(!rowId.IsEmpty && !this.Table.IsDel" +
                    "eted(rowId), \"Bad RowId\");\r\n\t\t\t");
            
            #line 109 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(" item;\r\n");
            
            #line 110 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
if(this.RealmType == RealmType.Universe) {
            
            #line default
            #line hidden
            this.Write("\t\t\tif((item = this.Find(rowId)) != null) {\r\n");
            
            #line 112 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
} else if(this.RealmType == RealmType.Multiverse) {
            
            #line default
            #line hidden
            this.Write("\t\t\tif(this.itemByRowId.TryGetValue(rowId, out item)) {\r\n");
            
            #line 114 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
}
            
            #line default
            #line hidden
            this.Write("\t\t\t\tDebug.Assert(!item.IsDeleted(), \"Deleted item should not be present in the di" +
                    "ctionary\");\r\n\t\t\t\treturn item;\r\n\t\t\t}\r\n");
            
            #line 118 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"

if(isSubclass || this.Table.Subclasses().FirstOrDefault() != null) {
	Key primaryKey = this.Table.PrimaryKey();
	if(primaryKey.KeyType != KeyType.Auto) {
		Column pkColumn = primaryKey[0];
		this.WriteLine("\t\t\t" + pkColumn.Type + " primaryKeyValue = this.Table.GetField(rowId, " + this.Table.Name + "Data." + pkColumn.Name + "Field.Field);");
	} else {
		this.WriteLine("\t\t\tRowId primaryKeyValue = rowId;");
	}
}

            
            #line default
            #line hidden
            
            #line 129 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"

if(this.Table.Subclasses().FirstOrDefault() != null) {
	foreach(Table subclass in this.Table.Subclasses()) {
		// Note! subclass cannot have auto primary key.
		string primaryKeyField = subclass.Name + "Data." + subclass.PrimaryKey()[0].Name + "Field.Field";

            
            #line default
            #line hidden
            this.Write("\r\n\t\t\tRowId rowId");
            
            #line 136 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(subclass.Name));
            
            #line default
            #line hidden
            this.Write(" = this.");
            
            #line 136 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Store.Name));
            
            #line default
            #line hidden
            this.Write(".");
            
            #line 136 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(subclass.Name));
            
            #line default
            #line hidden
            this.Write("Set.Table.Find(");
            
            #line 136 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(primaryKeyField));
            
            #line default
            #line hidden
            this.Write(", primaryKeyValue);\r\n\t\t\tif(!rowId");
            
            #line 137 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(subclass.Name));
            
            #line default
            #line hidden
            this.Write(".IsEmpty) {\r\n\t\t\t\treturn this.");
            
            #line 138 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Store.Name));
            
            #line default
            #line hidden
            this.Write(".");
            
            #line 138 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(subclass.Name));
            
            #line default
            #line hidden
            this.Write("Set.FindOrCreate(rowId");
            
            #line 138 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(subclass.Name));
            
            #line default
            #line hidden
            this.Write(");\r\n\t\t\t}\r\n");
            
            #line 140 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"

	}
}

            
            #line default
            #line hidden
            this.Write("\r\n");
            
            #line 145 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
if(!isSubclass) {
            
            #line default
            #line hidden
            this.Write("\t\t\treturn this.Create(rowId);\r\n");
            
            #line 147 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
} else {
	Column mainPrimary = this.Table.PrimaryKey()[0];
	string selectList = "rowId";

            
            #line default
            #line hidden
            this.Write("\r\n");
            
            #line 152 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"

	foreach(Table parent in this.Table.Ancestors(false)) {
		Key pk = parent.PrimaryKey();
		if(pk.KeyType == KeyType.Auto) {
			selectList += ", primaryKeyValue";
			continue;
		} else {
			selectList += ", table" + parent.Name + ".Find(" + parent.Name + "Data." + pk[0].Name + "Field.Field, primaryKeyValue)";
		}

            
            #line default
            #line hidden
            this.Write("\t\t\tTableSnapshot<");
            
            #line 162 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(parent.Name));
            
            #line default
            #line hidden
            this.Write("Data> table");
            
            #line 162 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(parent.Name));
            
            #line default
            #line hidden
            this.Write(" = (TableSnapshot<");
            
            #line 162 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(parent.Name));
            
            #line default
            #line hidden
            this.Write("Data>)this.");
            
            #line 162 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Store.Name));
            
            #line default
            #line hidden
            this.Write(".Table(\"");
            
            #line 162 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(parent.Name));
            
            #line default
            #line hidden
            this.Write("\");\r\n");
            
            #line 163 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
	}
            
            #line default
            #line hidden
            this.Write("\t\t\treturn this.Create(");
            
            #line 164 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(selectList));
            
            #line default
            #line hidden
            this.Write(");\r\n");
            
            #line 165 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
}
            
            #line default
            #line hidden
            this.Write("\t\t}\r\n\r\n\t\t// Creates ");
            
            #line 168 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(" wrapper\r\n\t\tprivate ");
            
            #line 169 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(" CreateItem(\r\n\t\t\t// Fields of ");
            
            #line 170 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(" table\r\n");
            
            #line 171 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"

foreach(Column column in this.Table.Columns) {
	Key foreign = this.Table.ForeignKey(column);
	if(foreign != null && foreign.KeyType == KeyType.Subclass && this.Table.Ancestors(true).Last().PrimaryKey().KeyType == KeyType.Auto) {
		continue;
	}
	this.Write("\t\t\t");
	if(foreign == null || foreign.KeyType == KeyType.Subclass) {
		this.Write(column.Type + " " + column.Name);
	} else {
		this.Write(foreign.ParentName + " " + foreign.RoleName());
	}
	if(!column.IsLast()) {
		this.WriteLine(",");
	}
}
if(isSubclass) {
	this.WriteLine("");
	foreach(Table parent in this.Table.Ancestors(false)) {
		this.WriteLine("\t\t\t// Fields of " + parent.Name + " table");
		foreach(Column column in parent.Columns) {
			if(!parent.IsPrimary(column)) {
				this.Write("\t\t\t,");
				Key foreign = parent.ForeignKey(column);
				if(foreign == null) {
					this.Write(column.Type + " " + column.Name);
				} else {
					this.Write(foreign.ParentName + " " + foreign.RoleName());
				}
				//if(!column.IsLast()) {
				//	this.WriteLine(",");
				//}
			}
		}
	}
}

            
            #line default
            #line hidden
            this.Write("\r\n\t\t) {\r\n");
            
            #line 210 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"

string subclassInsert = string.Empty;
if(isSubclass) {
	Column mainPrimary = this.Table.PrimaryKey()[0];
	foreach(Table parent in this.Table.Ancestors(false).Reverse()) {
		subclassInsert += ", rowId" + parent.Name;

            
            #line default
            #line hidden
            this.Write("\t\t\tTableSnapshot<");
            
            #line 217 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(parent.Name));
            
            #line default
            #line hidden
            this.Write("Data> table");
            
            #line 217 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(parent.Name));
            
            #line default
            #line hidden
            this.Write(" = (TableSnapshot<");
            
            #line 217 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(parent.Name));
            
            #line default
            #line hidden
            this.Write("Data>)this.");
            
            #line 217 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Store.Name));
            
            #line default
            #line hidden
            this.Write(".Table(\"");
            
            #line 217 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(parent.Name));
            
            #line default
            #line hidden
            this.Write("\");\r\n\t\t\t");
            
            #line 218 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(parent.Name));
            
            #line default
            #line hidden
            this.Write("Data data");
            
            #line 218 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(parent.Name));
            
            #line default
            #line hidden
            this.Write(" = new ");
            
            #line 218 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(parent.Name));
            
            #line default
            #line hidden
            this.Write("Data() {\r\n");
            
            #line 219 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"

		foreach(Column column in parent.Columns) {
			this.Write("\t\t\t\t");
			if(parent.IsPrimary(column)) {
				this.Write(column.Name + " = ");
				if(parent.Ancestors(true).Last().PrimaryKey().KeyType == KeyType.Auto) {
					this.Write("rowId" + parent.BaseName());
				} else {
					this.Write(mainPrimary.Name);
				}
			} else {
				Key foreign = parent.ForeignKey(column);
				if(foreign == null) {
					this.Write(column.Name + " = " + column.Name);
				} else {
					string fn = foreign.RoleName();
					Key primaryKey = foreign.Parent().PrimaryKey();
					string parentId = (primaryKey.KeyType == KeyType.Auto) ? primaryKey.Table.Name + "RowId" : primaryKey[0].Name;
					this.Write(column.Name + " = (" + fn + " != null) ? " + fn + "." + parentId + " : " + parent.Name + "Data." + column.Name + "Field.Field.DefaultValue");
				}
			}
			if(column != parent.Columns[parent.Columns.Count - 1]) {
				this.Write(",");
			}
			this.WriteLine(null);
		}

            
            #line default
            #line hidden
            this.Write("\t\t\t};\r\n\t\t\tRowId rowId");
            
            #line 247 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(parent.Name));
            
            #line default
            #line hidden
            this.Write(" = table");
            
            #line 247 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(parent.Name));
            
            #line default
            #line hidden
            this.Write(".Insert(ref data");
            
            #line 247 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(parent.Name));
            
            #line default
            #line hidden
            this.Write(");\r\n\r\n");
            
            #line 249 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"

	}
}

            
            #line default
            #line hidden
            this.Write("\t\t\t");
            
            #line 253 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Data data");
            
            #line 253 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(" = new ");
            
            #line 253 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Data() {\r\n");
            
            #line 254 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"

foreach(Column column in this.Table.Columns) {
	Key foreign = this.Table.ForeignKey(column);
	if(foreign == null || foreign.KeyType == KeyType.Subclass) {
		string value = column.Name;
		if(foreign != null && this.Table.Ancestors(true).Last().PrimaryKey().KeyType == KeyType.Auto) {
			value = "rowId" + foreign.ParentName;
		}

            
            #line default
            #line hidden
            this.Write("\t\t\t\t");
            
            #line 263 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(column.Name));
            
            #line default
            #line hidden
            this.Write(" = ");
            
            #line 263 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(value));
            
            #line default
            #line hidden
            this.Write(",\r\n");
            
            #line 264 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"

	} else {
		Table parent = foreign.Parent();
		Key primaryKey = parent.PrimaryKey();
		string parentId = (primaryKey.KeyType == KeyType.Auto) ? parent.Name + "RowId" : primaryKey[0].Name;

            
            #line default
            #line hidden
            this.Write("\t\t\t\t");
            
            #line 270 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(column.Name));
            
            #line default
            #line hidden
            this.Write(" = (");
            
            #line 270 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(foreign.RoleName()));
            
            #line default
            #line hidden
            this.Write(" != null) ? ");
            
            #line 270 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(foreign.RoleName()));
            
            #line default
            #line hidden
            this.Write(".");
            
            #line 270 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(parentId));
            
            #line default
            #line hidden
            this.Write(" : ");
            
            #line 270 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Data.");
            
            #line 270 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(column.Name));
            
            #line default
            #line hidden
            this.Write("Field.Field.DefaultValue,\r\n");
            
            #line 271 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"

	}
}

            
            #line default
            #line hidden
            this.Write("\t\t\t};\r\n\t\t\treturn this.Create(this.Table.Insert(ref data");
            
            #line 276 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(")");
            
            #line 276 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(subclassInsert));
            
            #line default
            #line hidden
            this.Write(");\r\n\t\t}\r\n\r\n\t\t// Search helpers\r\n\r\n");
            
            #line 281 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"

System.Collections.Generic.HashSet<string> searchFunctionName = new System.Collections.Generic.HashSet<string>();
foreach(Key key in this.Table.Keys) {
	string returnType = this.Table.Name;
	string function = "Find";
	if(!key.IsUnique()) {
		returnType = "IEnumerable<" + returnType + ">";
		function = "Select";
	}
	if(key.Count == 1) {
		Column column = key[0];
		if(key.IsUnique() || this.Table.UniqueKey(column) == null) {
			Key foreign = this.Table.ForeignKey(column);
			if(foreign != null && foreign.KeyType == KeyType.Subclass) {
				foreign = null;
			}
			string columnType = column.Type;
			string columnName = column.Name;
			string value = this.Camelize(columnName);
			if(foreign != null) {
				columnType = foreign.ParentName;
				columnName = foreign.RoleName();
				Table parent = foreign.Parent();
				Key primaryKey = parent.PrimaryKey();
				value = this.Camelize(columnName) + "." + ((primaryKey.KeyType == KeyType.Auto) ? parent.Name + "RowId" : primaryKey[0].Name);
			}
			string suffix = "";
			if(!key.IsPrimary() || isSubclass) {
				suffix = "By" + columnName;
			}
			if(searchFunctionName.Add(function + suffix)) {

            
            #line default
            #line hidden
            this.Write("\t\t// ");
            
            #line 313 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(function));
            
            #line default
            #line hidden
            this.Write("s ");
            
            #line 313 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(" by ");
            
            #line 313 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(columnName));
            
            #line default
            #line hidden
            this.Write("\r\n\t\tpublic ");
            
            #line 314 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(returnType));
            
            #line default
            #line hidden
            this.Write(" ");
            
            #line 314 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(function));
            
            #line default
            #line hidden
            
            #line 314 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(suffix));
            
            #line default
            #line hidden
            this.Write("(");
            
            #line 314 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(columnType));
            
            #line default
            #line hidden
            this.Write(" ");
            
            #line 314 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Camelize(columnName)));
            
            #line default
            #line hidden
            this.Write(") {\r\n\t\t\treturn this.");
            
            #line 315 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(function));
            
            #line default
            #line hidden
            this.Write("(this.Table.");
            
            #line 315 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(function));
            
            #line default
            #line hidden
            this.Write("(");
            
            #line 315 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Data.");
            
            #line 315 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(column.Name));
            
            #line default
            #line hidden
            this.Write("Field.Field, ");
            
            #line 315 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(value));
            
            #line default
            #line hidden
            this.Write("));\r\n\t\t}\r\n\r\n");
            
            #line 318 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"

			}
		}
	} else if(key.KeyType != KeyType.Auto) {
		Column column0 = key[0];
		Column column1 = key[1];
		if(key.IsUnique() || this.Table.UniqueKey(column0, column1) == null) {
			Key foreign0 = this.Table.ForeignKey(column0);
			if(foreign0 != null && foreign0.KeyType == KeyType.Subclass) {
				foreign0 = null;
			}
			string column0Type = column0.Type;
			string column0Name = column0.Name;
			string value0 = this.Camelize(column0Name);
			if(foreign0 != null) {
				column0Type = foreign0.ParentName;
				column0Name = foreign0.RoleName();
				Table parent = foreign0.Parent();
				Key primaryKey = parent.PrimaryKey();
				value0 = this.Camelize(column0Name) + "." + ((primaryKey.KeyType == KeyType.Auto) ? parent.Name + "RowId" : primaryKey[0].Name);
			}
			Key foreign1 = this.Table.ForeignKey(column1);
			if(foreign1 != null && foreign1.KeyType == KeyType.Subclass) {
				foreign1 = null;
			}
			string column1Type = column1.Type;
			string column1Name = column1.Name;
			string value1 = this.Camelize(column1Name);
			if(foreign1 != null) {
				column1Type = foreign1.ParentName;
				column1Name = foreign1.RoleName();
				Table parent = foreign1.Parent();
				Key primaryKey = parent.PrimaryKey();
				value1 = this.Camelize(column1Name) + "." + ((primaryKey.KeyType == KeyType.Auto) ? parent.Name + "RowId" : primaryKey[0].Name);
			}
			string suffix = "";
			if(!key.IsPrimary()) {
				suffix = "By" + column0Name + "And" + column1Name;
			}
			if(searchFunctionName.Add(function + suffix)) {

            
            #line default
            #line hidden
            this.Write("\t\t// ");
            
            #line 359 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(function));
            
            #line default
            #line hidden
            this.Write("s ");
            
            #line 359 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(" by ");
            
            #line 359 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(column0Name));
            
            #line default
            #line hidden
            this.Write(" and ");
            
            #line 359 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(column1Name));
            
            #line default
            #line hidden
            this.Write("\r\n\t\tpublic ");
            
            #line 360 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(returnType));
            
            #line default
            #line hidden
            this.Write(" ");
            
            #line 360 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(function));
            
            #line default
            #line hidden
            
            #line 360 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(suffix));
            
            #line default
            #line hidden
            this.Write("(");
            
            #line 360 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(column0Type));
            
            #line default
            #line hidden
            this.Write(" ");
            
            #line 360 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Camelize(column0Name)));
            
            #line default
            #line hidden
            this.Write(", ");
            
            #line 360 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(column1Type));
            
            #line default
            #line hidden
            this.Write(" ");
            
            #line 360 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Camelize(column1Name)));
            
            #line default
            #line hidden
            this.Write(") {\r\n\t\t\treturn this.");
            
            #line 361 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(function));
            
            #line default
            #line hidden
            this.Write("(\r\n\t\t\t\tthis.Table.");
            
            #line 362 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(function));
            
            #line default
            #line hidden
            this.Write("(\r\n\t\t\t\t\t");
            
            #line 363 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Data.");
            
            #line 363 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(column0.Name));
            
            #line default
            #line hidden
            this.Write("Field.Field, ");
            
            #line 363 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Data.");
            
            #line 363 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(column1.Name));
            
            #line default
            #line hidden
            this.Write("Field.Field,\r\n\t\t\t\t\t");
            
            #line 364 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(value0));
            
            #line default
            #line hidden
            this.Write(", ");
            
            #line 364 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(value1));
            
            #line default
            #line hidden
            this.Write("\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t}\r\n\r\n");
            
            #line 369 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"

			}
		}
	}
}

            
            #line default
            #line hidden
            this.Write("\t\tpublic IEnumerator<");
            
            #line 375 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("> GetEnumerator() {\r\n");
            
            #line 376 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
if(this.RealmType != RealmType.Universe) {
            
            #line default
            #line hidden
            this.Write("\t\t\tif(this.");
            
            #line 377 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Store.Name));
            
            #line default
            #line hidden
            this.Write(".IsEditor || this.");
            
            #line 377 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Store.Name));
            
            #line default
            #line hidden
            this.Write(".UpdateInProgress) {\r\n\t\t\t\treturn new Enumerator(this, this.Table.GetEnumerator())" +
                    ";\r\n\t\t\t} else {\r\n\t\t\t\treturn this.itemByRowId.Values.GetEnumerator();\r\n\t\t\t}\r\n");
            
            #line 382 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
} else {
            
            #line default
            #line hidden
            this.Write("\t\t\treturn this.Select(this.Table.Rows).GetEnumerator();\r\n");
            
            #line 384 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
}
            
            #line default
            #line hidden
            this.Write(@"		}

		System.Collections.IEnumerator System.Collections.IEnumerable.GetEnumerator() {
			return this.GetEnumerator();
		}

		private void NotifyCollectionChanged(NotifyCollectionChangedEventArgs arg) {
			NotifyCollectionChangedEventHandler handler = this.CollectionChanged;
			if(handler != null) {
");
            
            #line 394 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
if(this.UseDispatcher) {
            
            #line default
            #line hidden
            this.Write("\t\t\t\tSystem.Windows.Threading.Dispatcher dispatcher = this.");
            
            #line 395 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Store.Name));
            
            #line default
            #line hidden
            this.Write(".Dispatcher;\r\n\t\t\t\tif(dispatcher != null && dispatcher.Thread != System.Threading." +
                    "Thread.CurrentThread) {\r\n\t\t\t\t\tdispatcher.Invoke(new Action<NotifyCollectionChang" +
                    "edEventArgs>(this.NotifyCollectionChanged), arg);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n");
            
            #line 400 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
}
            
            #line default
            #line hidden
            this.Write("\t\t\t\thandler(this, arg);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tinternal List<");
            
            #line 405 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("> UpdateSet(int oldVersion, int newVersion) {\r\n\t\t\tIEnumerator<TableChange<");
            
            #line 406 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Data>> change = this.Table.GetVersionChangeChanges(oldVersion, newVersion);\r\n\t\t\ti" +
                    "f(change != null) {\r\n\t\t\t\tbool handlerAttached = (this.CollectionChanged != null)" +
                    ";\r\n\t\t\t\tList<");
            
            #line 409 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("> del = (handlerAttached) ? new List<");
            
            #line 409 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(@">() : null;
				while(change.MoveNext()) {
					switch(change.Current.Action) {
					case SnapTableAction.Insert:
						this.FindOrCreate(change.Current.RowId);
						Debug.Assert(this.Find(change.Current.RowId) != null, ""Why the item was not created?"");
						break;
					case SnapTableAction.Delete:
");
            
            #line 417 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
if(this.RealmType != RealmType.Universe) {
            
            #line default
            #line hidden
            this.Write("\t\t\t\t\t\tDebug.Assert(this.Find(change.Current.RowId) != null, \"Why the item does no" +
                    "t exist?\");\r\n\t\t\t\t\t\tif(handlerAttached) {\r\n\t\t\t\t\t\t\tdel.Add(this.Find(change.Curren" +
                    "t.RowId));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.Delete(change.Current.RowId);\r\n");
            
            #line 423 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
} else {
            
            #line default
            #line hidden
            this.Write("\t\t\t\t\t\tif(handlerAttached) {\r\n\t\t\t\t\t\t\t");
            
            #line 425 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(" item = change.Current.GetOldField(");
            
            #line 425 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Data.");
            
            #line 425 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Field.Field);\r\n\t\t\t\t\t\t\tDebug.Assert(item.IsDeleted());\r\n\t\t\t\t\t\t\tdel.Add(item);\r\n\t\t\t" +
                    "\t\t\t}\r\n");
            
            #line 429 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
}
            
            #line default
            #line hidden
            this.Write(@"						break;
					default:
						Debug.Assert(change.Current.Action == SnapTableAction.Update, ""Unknown action"");
						Debug.Assert(this.Find(change.Current.RowId) != null, ""Why the item does not exist during update?"");
						break;
					}
				}
				change.Dispose();
				return del;
			}
			return null;
		}

		internal void NotifyVersionChanged(int oldVersion, int newVersion, List<");
            
            #line 443 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("> deleted) {\r\n\t\t\tIEnumerator<TableChange<");
            
            #line 444 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Data>> change = this.Table.GetVersionChangeChanges(oldVersion, newVersion);\r\n\t\t\ti" +
                    "f(change != null) {\r\n\t\t\t\tbool handlerAttached = (this.CollectionChanged != null)" +
                    ";\r\n\t\t\t\tList<");
            
            #line 447 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("> add = (handlerAttached) ? new List<");
            
            #line 447 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(">() : null;\r\n\t\t\t\tthis.StartNotify");
            
            #line 448 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("SetChanged(oldVersion, newVersion);\r\n\t\t\t\twhile(change.MoveNext()) {\r\n\t\t\t\t\tthis.No" +
                    "tify");
            
            #line 450 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(@"SetChanged(change.Current);
					switch(change.Current.Action) {
					case SnapTableAction.Insert:
						Debug.Assert(this.Find(change.Current.RowId) != null, ""Why the item was not created?"");
						if(handlerAttached) {
							add.Add(this.Find(change.Current.RowId));
						}
						break;
					case SnapTableAction.Delete:
");
            
            #line 459 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
if(this.RealmType != RealmType.Universe) {
            
            #line default
            #line hidden
            this.Write("\t\t\t\t\t\tDebug.Assert(this.Find(change.Current.RowId) == null, \"Why the item still e" +
                    "xists?\");\r\n");
            
            #line 461 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
} else {
            
            #line default
            #line hidden
            this.Write("\t\t\t\t\t\tDebug.Assert(change.Current.GetOldField(");
            
            #line 462 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Data.");
            
            #line 462 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Field.Field).IsDeleted(), \"Why the item still exists?\");\r\n");
            
            #line 463 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
}
            
            #line default
            #line hidden
            this.Write(@"						break;
					default:
						Debug.Assert(change.Current.Action == SnapTableAction.Update, ""Unknown action"");
						Debug.Assert(this.Find(change.Current.RowId) != null, ""Why the item does not exist during update?"");
						this.Find(change.Current.RowId).NotifyChanged(change.Current);
						break;
					}
				}
				change.Dispose();
				if(handlerAttached) {
					if(deleted != null && 0 < deleted.Count) {
						this.NotifyCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Remove, deleted));
					}
					if(0 < add.Count) {
						this.NotifyCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Add, add));
					}
				}
				this.EndNotify");
            
            #line 481 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("SetChanged();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpartial void StartNotify");
            
            #line 485 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("SetChanged(int oldVersion, int newVersion);\r\n\t\tpartial void EndNotify");
            
            #line 486 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("SetChanged();\r\n\t\tpartial void Notify");
            
            #line 487 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("SetChanged(TableChange<");
            
            #line 487 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(@"Data> change);

		internal void NotifyRolledBack(int version) {
			if(this.Table.WasAffected(version)) {
				IEnumerator<RowId> change = this.Table.GetRolledBackChanges(version);
				if(change != null) {
					while(change.MoveNext()) {
						RowId rowId = change.Current;
						if(this.Table.IsDeleted(rowId)) {
							this.Delete(rowId);
						} else {
							this.FindOrCreate(rowId);
						}
					}
					change.Dispose();
				}
			}
		}
");
            
            #line 505 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
if(this.RealmType != RealmType.Universe) {
            
            #line default
            #line hidden
            this.Write("\r\n\t\tprivate class Enumerator : IEnumerator<");
            
            #line 507 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("> {\r\n\t\t\tprivate ");
            
            #line 508 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Set set;\r\n\t\t\tprivate IEnumerator<RowId> enumerator;\r\n\t\t\tpublic Enumerator(");
            
            #line 510 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write("Set set, IEnumerator<RowId> enumerator) {\r\n\t\t\t\tthis.set = set;\r\n\t\t\t\tthis.enumerat" +
                    "or = enumerator;\r\n\t\t\t}\r\n\r\n\t\t\tpublic bool MoveNext() {\r\n\t\t\t\treturn this.enumerato" +
                    "r.MoveNext();\r\n\t\t\t}\r\n\r\n\t\t\tpublic ");
            
            #line 519 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
            this.Write(this.ToStringHelper.ToStringWithCulture(this.Table.Name));
            
            #line default
            #line hidden
            this.Write(@" Current { get { return this.set.Find(this.enumerator.Current); } }
			object System.Collections.IEnumerator.Current { get { return this.Current; } }

			public void Dispose() {
			}

			public void Reset() {
				throw new NotSupportedException();
			}
		}
");
            
            #line 529 "C:\Eugene\Projects\LogicCircuit\LogicCircuit\FxCop\Sources\Tools\ItemWrapper.Generator\GeneratorSetWrapper.tt"
}
            
            #line default
            #line hidden
            this.Write("\t}\r\n");
            return this.GenerationEnvironment.ToString();
        }
    }
    
    #line default
    #line hidden
}
